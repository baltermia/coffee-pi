@using System.Text.RegularExpressions
@using System.ComponentModel.DataAnnotations
@using CoffeePi.Shared.DataTransferObjects

@inject ISnackbar Snackbar
@inject HttpClient Http
@inject IDialogService DialogService

<MudDialog>
    <DialogContent>
            <MudForm @ref="form" @bind-IsValid="@success" @bind-Errors="@errors">
                <RadzenDatePicker TValue="DateTime?" ShowTime="true" HoursStep="1.5" MinutesStep="5" @bind-Value=@Time/>
                <MudButton OnClick="TimeNow">Jetzt</MudButton>

            </MudForm>   
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Abbrechen</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Weiter</MudButton>
    </DialogActions>
</MudDialog>


@code{

    MudForm form;
    bool success;
    string[] errors = { };
    private DateTime? Time;


    [Parameter]
    public CoffeeButton CoffeeType { get; set; }

    [CascadingParameter] 
    MudDialogInstance MudDialog { get; set; }


    async void TimeNow()
    {
        //evtl. Todo: Add a few Seconds to Dateime Now
        Time = DateTime.Now;
        await Submit();
    }

    async Task Submit()
    {
        var parameters = new DialogParameters();
        var options = new MudBlazor.DialogOptions { CloseOnEscapeKey = true };
        parameters.Add("Time", Time);
        parameters.Add("CoffeeType", CoffeeType);
        var Dialog = DialogService.Show<CoffeeRepeatModal>("Wiederholung", parameters, options);
        var result = await Dialog.Result;
       MudDialog.Close(DialogResult.Ok(true));
    }





    void Cancel() => MudDialog.Cancel();


}

